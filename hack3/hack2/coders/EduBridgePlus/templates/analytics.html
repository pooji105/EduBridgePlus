<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduBridge+ - Analytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>EduBridge+</h1>
            <p class="tagline">Learn. Act. Impact.</p>
        </div>
    </div>

    <div class="container">
        <div class="content">
            <h2>üìà Platform Analytics</h2>
            <p class="intro">Discover insights about sustainability learning trends and platform engagement across our community.</p>
            
            <!-- Platform Overview -->
            <div class="analytics-overview">
                <h3>üìä Platform Overview</h3>
                <div class="overview-stats">
                    <div class="overview-card">
                        <div class="overview-icon">üë•</div>
                        <div class="overview-content">
                            <h4>{{ total_users }}</h4>
                            <p>Active Learners</p>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon">üìù</div>
                        <div class="overview-content">
                            <h4>{{ total_posts }}</h4>
                            <p>Community Posts</p>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon">üß†</div>
                        <div class="overview-content">
                            <h4>{{ total_quiz_attempts }}</h4>
                            <p>Quiz Attempts</p>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon">üëç</div>
                        <div class="overview-content">
                            <h4>{{ total_likes }}</h4>
                            <p>Total Likes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SDG Distribution Chart -->
            <div class="chart-section">
                <h3>üéØ SDG Learning Distribution</h3>
                <div class="chart-container">
                    <canvas id="sdgChart"></canvas>
                </div>
            </div>

            <!-- Topic Popularity -->
            <div class="topic-stats-section">
                <h3>üî• Most Popular Topics</h3>
                <p class="section-description">Topics ranked by quiz attempts and average scores</p>
                <div class="topic-stats-grid">
                    {% for topic_stat in topic_stats %}
                    <div class="topic-stat-card">
                        <div class="topic-name">{{ topic_stat.topic }}</div>
                        <div class="topic-metrics">
                            <div class="metric">
                                <span class="metric-label">Attempts:</span>
                                <span class="metric-value">{{ topic_stat.attempts }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Avg Score:</span>
                                <span class="metric-value">{{ "%.1f"|format(topic_stat.avg_score) }}%</span>
                            </div>
                        </div>
                        <div class="topic-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ (topic_stat.avg_score / 100 * 100) if topic_stat.avg_score else 0 }}%"></div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- SDG Impact Summary -->
            <div class="sdg-impact-section">
                <h3>üåç SDG Impact Summary</h3>
                <div class="sdg-impact-grid">
                    <div class="sdg-impact-card sdg-4">
                        <div class="sdg-impact-icon">üìö</div>
                        <div class="sdg-impact-content">
                            <h4>SDG 4: Quality Education</h4>
                            <div class="impact-stat">{{ sdg_stats.sdg_4 }}</div>
                            <div class="impact-label">Topics Learned</div>
                        </div>
                    </div>
                    <div class="sdg-impact-card sdg-6">
                        <div class="sdg-impact-icon">üíß</div>
                        <div class="sdg-impact-content">
                            <h4>SDG 6: Clean Water</h4>
                            <div class="impact-stat">{{ sdg_stats.sdg_6 }}</div>
                            <div class="impact-label">Topics Learned</div>
                        </div>
                    </div>
                    <div class="sdg-impact-card sdg-13">
                        <div class="sdg-impact-icon">üåç</div>
                        <div class="sdg-impact-content">
                            <h4>SDG 13: Climate Action</h4>
                            <div class="impact-stat">{{ sdg_stats.sdg_13 }}</div>
                            <div class="impact-label">Topics Learned</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Your Personal Analytics -->
            <div class="personal-analytics">
                <h3>üìä Your Learning Journey</h3>
                <div class="personal-stats">
                    <div class="personal-card">
                        <div class="personal-icon">üìö</div>
                        <div class="personal-content">
                            <h4>{{ progress.topics_learned }}</h4>
                            <p>Topics Completed</p>
                        </div>
                    </div>
                    <div class="personal-card">
                        <div class="personal-icon">üß†</div>
                        <div class="personal-content">
                            <h4>{{ progress.quizzes_completed }}</h4>
                            <p>Quizzes Taken</p>
                        </div>
                    </div>
                    <div class="personal-card">
                        <div class="personal-icon">‚≠ê</div>
                        <div class="personal-content">
                            <h4>{{ progress.total_score }}</h4>
                            <p>Total Score</p>
                        </div>
                    </div>
                    <div class="personal-card">
                        <div class="personal-icon">üèÜ</div>
                        <div class="personal-content">
                            <h4>{{ progress.badges|length }}</h4>
                            <p>Badges Earned</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="navigation">
                <a href="/" class="btn">Back to Home</a>
                <a href="/learn" class="btn">Continue Learning</a>
                <a href="/dashboard" class="btn">View Dashboard</a>
                <a href="/leaderboard" class="btn">Leaderboard</a>
            </div>
        </div>
    </div>

    <script>
        // SDG Distribution Chart
        const ctx = document.getElementById('sdgChart').getContext('2d');
        const sdgChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['SDG 4: Education', 'SDG 6: Water', 'SDG 13: Climate'],
                datasets: [{
                    data: [{{ sdg_stats.sdg_4 }}, {{ sdg_stats.sdg_6 }}, {{ sdg_stats.sdg_13 }}],
                    backgroundColor: [
                        '#4CAF50',
                        '#2196F3',
                        '#FF9800'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + ' topics';
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    duration: 2000
                }
            }
        });
    </script>

    <style>
        .analytics-overview {
            margin: 40px 0;
            background: linear-gradient(135deg, #e8f5e8 0%, #e3f2fd 100%);
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #4caf50;
        }

        .analytics-overview h3 {
            color: #2e7d32;
            margin-top: 0;
            font-size: 1.8em;
            text-align: center;
        }

        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .overview-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-5px);
        }

        .overview-icon {
            font-size: 2.5em;
            opacity: 0.8;
        }

        .overview-content h4 {
            font-size: 2em;
            margin: 0;
            color: #2e7d32;
            font-weight: 700;
        }

        .overview-content p {
            margin: 5px 0 0 0;
            color: #666;
            font-weight: 500;
        }

        .chart-section {
            margin: 40px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #2196f3;
        }

        .chart-section h3 {
            color: #1976d2;
            margin-top: 0;
            font-size: 1.8em;
            text-align: center;
        }

        .chart-container {
            height: 400px;
            margin: 20px 0;
        }

        .topic-stats-section {
            margin: 40px 0;
            background: linear-gradient(135deg, #fff3e0 0%, #f3e5f5 100%);
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #ff9800;
        }

        .topic-stats-section h3 {
            color: #e65100;
            margin-top: 0;
            font-size: 1.8em;
            text-align: center;
        }

        .section-description {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-style: italic;
        }

        .topic-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .topic-stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .topic-stat-card:hover {
            transform: translateY(-5px);
        }

        .topic-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 15px;
            text-align: center;
        }

        .topic-metrics {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .metric {
            text-align: center;
        }

        .metric-label {
            display: block;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-value {
            display: block;
            font-size: 1.2em;
            font-weight: 700;
            color: #2e7d32;
        }

        .topic-progress .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .topic-progress .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4caf50 0%, #2196f3 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .sdg-impact-section {
            margin: 40px 0;
            background: linear-gradient(135deg, #e8f5e8 0%, #e3f2fd 100%);
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #4caf50;
        }

        .sdg-impact-section h3 {
            color: #2e7d32;
            margin-top: 0;
            font-size: 1.8em;
            text-align: center;
        }

        .sdg-impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sdg-impact-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .sdg-impact-card:hover {
            transform: translateY(-5px);
        }

        .sdg-impact-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .sdg-impact-content h4 {
            color: #2e7d32;
            margin: 0 0 15px 0;
            font-size: 1.2em;
        }

        .impact-stat {
            font-size: 2.5em;
            font-weight: 700;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .impact-label {
            color: #666;
            font-weight: 500;
        }

        .personal-analytics {
            margin: 40px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #2196f3;
        }

        .personal-analytics h3 {
            color: #1976d2;
            margin-top: 0;
            font-size: 1.8em;
            text-align: center;
        }

        .personal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .personal-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease;
        }

        .personal-card:hover {
            transform: translateY(-5px);
        }

        .personal-icon {
            font-size: 2.5em;
            opacity: 0.8;
        }

        .personal-content h4 {
            font-size: 2em;
            margin: 0;
            color: #2e7d32;
            font-weight: 700;
        }

        .personal-content p {
            margin: 5px 0 0 0;
            color: #666;
            font-weight: 500;
        }
    </style>
</body>
</html>
